{"ast":null,"code":"var Sequence = require('./Sequence');\n\nvar Util = require('util');\n\nvar Packets = require('../packets');\n\nvar Auth = require('../Auth');\n\nmodule.exports = ChangeUser;\nUtil.inherits(ChangeUser, Sequence);\n\nfunction ChangeUser(options, callback) {\n  Sequence.call(this, options, callback);\n  this._user = options.user;\n  this._password = options.password;\n  this._database = options.database;\n  this._charsetNumber = options.charsetNumber;\n  this._currentConfig = options.currentConfig;\n}\n\nChangeUser.prototype.determinePacket = function determinePacket(firstByte) {\n  switch (firstByte) {\n    case 0xfe:\n      return Packets.AuthSwitchRequestPacket;\n\n    case 0xff:\n      return Packets.ErrorPacket;\n\n    default:\n      return undefined;\n  }\n};\n\nChangeUser.prototype.start = function (handshakeInitializationPacket) {\n  var scrambleBuff = handshakeInitializationPacket.scrambleBuff();\n  scrambleBuff = Auth.token(this._password, scrambleBuff);\n  var packet = new Packets.ComChangeUserPacket({\n    user: this._user,\n    scrambleBuff: scrambleBuff,\n    database: this._database,\n    charsetNumber: this._charsetNumber\n  });\n  this._currentConfig.user = this._user;\n  this._currentConfig.password = this._password;\n  this._currentConfig.database = this._database;\n  this._currentConfig.charsetNumber = this._charsetNumber;\n  this.emit('packet', packet);\n};\n\nChangeUser.prototype['AuthSwitchRequestPacket'] = function (packet) {\n  var name = packet.authMethodName;\n  var data = Auth.auth(name, packet.authMethodData, {\n    password: this._password\n  });\n\n  if (data !== undefined) {\n    this.emit('packet', new Packets.AuthSwitchResponsePacket({\n      data: data\n    }));\n  } else {\n    var err = new Error('MySQL is requesting the ' + name + ' authentication method, which is not supported.');\n    err.code = 'UNSUPPORTED_AUTH_METHOD';\n    err.fatal = true;\n    this.end(err);\n  }\n};\n\nChangeUser.prototype['ErrorPacket'] = function (packet) {\n  var err = this._packetToError(packet);\n\n  err.fatal = true;\n  this.end(err);\n};","map":{"version":3,"names":["Sequence","require","Util","Packets","Auth","module","exports","ChangeUser","inherits","options","callback","call","_user","user","_password","password","_database","database","_charsetNumber","charsetNumber","_currentConfig","currentConfig","prototype","determinePacket","firstByte","AuthSwitchRequestPacket","ErrorPacket","undefined","start","handshakeInitializationPacket","scrambleBuff","token","packet","ComChangeUserPacket","emit","name","authMethodName","data","auth","authMethodData","AuthSwitchResponsePacket","err","Error","code","fatal","end","_packetToError"],"sources":["C:/Users/ZCJ/Desktop/internshipsysrem/node_modules/mysql/lib/protocol/sequences/ChangeUser.js"],"sourcesContent":["var Sequence = require('./Sequence');\nvar Util     = require('util');\nvar Packets  = require('../packets');\nvar Auth     = require('../Auth');\n\nmodule.exports = ChangeUser;\nUtil.inherits(ChangeUser, Sequence);\nfunction ChangeUser(options, callback) {\n  Sequence.call(this, options, callback);\n\n  this._user          = options.user;\n  this._password      = options.password;\n  this._database      = options.database;\n  this._charsetNumber = options.charsetNumber;\n  this._currentConfig = options.currentConfig;\n}\n\nChangeUser.prototype.determinePacket = function determinePacket(firstByte) {\n  switch (firstByte) {\n    case 0xfe: return Packets.AuthSwitchRequestPacket;\n    case 0xff: return Packets.ErrorPacket;\n    default: return undefined;\n  }\n};\n\nChangeUser.prototype.start = function(handshakeInitializationPacket) {\n  var scrambleBuff = handshakeInitializationPacket.scrambleBuff();\n  scrambleBuff     = Auth.token(this._password, scrambleBuff);\n\n  var packet = new Packets.ComChangeUserPacket({\n    user          : this._user,\n    scrambleBuff  : scrambleBuff,\n    database      : this._database,\n    charsetNumber : this._charsetNumber\n  });\n\n  this._currentConfig.user          = this._user;\n  this._currentConfig.password      = this._password;\n  this._currentConfig.database      = this._database;\n  this._currentConfig.charsetNumber = this._charsetNumber;\n\n  this.emit('packet', packet);\n};\n\nChangeUser.prototype['AuthSwitchRequestPacket'] = function (packet) {\n  var name = packet.authMethodName;\n  var data = Auth.auth(name, packet.authMethodData, {\n    password: this._password\n  });\n\n  if (data !== undefined) {\n    this.emit('packet', new Packets.AuthSwitchResponsePacket({\n      data: data\n    }));\n  } else {\n    var err   = new Error('MySQL is requesting the ' + name + ' authentication method, which is not supported.');\n    err.code  = 'UNSUPPORTED_AUTH_METHOD';\n    err.fatal = true;\n    this.end(err);\n  }\n};\n\nChangeUser.prototype['ErrorPacket'] = function(packet) {\n  var err = this._packetToError(packet);\n  err.fatal = true;\n  this.end(err);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}